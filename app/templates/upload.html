{% extends "layout.html" %}
{% block title %}{{ super() }} â€” {{ data.title }}{% endblock %}

{% block content %}
<h1 class="text-3xl font-semibold mb-6 text-center text-gray-800">What Key is This?</h1>
<p class="text-gray-600 text-center mb-6">Upload your audio file to find its key.</p>
<!-- UPLOAD SECTION -->
<form id="uploadForm" class="space-y-4 mb-5">
    <div>
        <div id="drop-area" class="mt-1 flex justify-center items-center rounded-md border-2 border-dashed border-orange-600/80 hover:border-orange-800/80 px-6 py-32" alt="Upload a file">
            <div class="space-y-1">
                <svg class="mx-auto h-12 w-12 text-gray-800/60 hover:text-gray-800/80 pt-2" fill="currentColor" stroke="currentColor" viewBox="0 0 48 48" aria-hidden="true">
                    <path d="M24.446,0.573C24.079,0.203,23.502,0,22.925,0c-0.516,0-1.153,0.203-1.52,0.572l-11.4,11.481
                        c-0.56,0.563-0.725,1.408-0.417,2.139c0.306,0.731,1.022,1.207,1.815,1.206l3.72-0.03l-0.054,16.288
                        c0.006,1.613,1.316,2.919,2.93,2.919h9.855c1.611,0,2.922-1.306,2.928-2.919l-0.053-16.284l3.719,0.027
                        c0.793,0.002,1.512-0.474,1.815-1.206c0.308-0.73,0.144-1.577-0.417-2.139L24.446,0.573z"/>
                    <path d="M42.442,19.371c-1.623,0-2.947,1.315-2.947,2.938v16.392c0,0.678-0.522,1.217-1.203,1.217H7.47
                        c-0.68,0-1.239-0.539-1.239-1.217V22.308c0-1.622-1.282-2.938-2.905-2.938c-1.622,0-2.905,1.315-2.905,2.938V38.7
                        c0,3.918,3.131,7.11,7.05,7.11h30.821c3.92,0,7.098-3.192,7.098-7.11V22.308C45.389,20.686,44.063,19.371,42.442,19.371z"/>
                </svg>
                <div class="flex text-sm text-gray-600 pt-6">
                    <label for="audioFile" class="relative cursor-pointer rounded-md bg-white font-medium text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-offset-2 hover:text-blue-500">
                        <span>Upload a file</span>
                        <input id="audioFile" name="audio" type="file" class="sr-only" accept="audio/*">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                </div>
                <p class="text-xs text-gray-500 text-center">MP3, WAV, or OGG up to 10MB</p>
            </div>
        </div>
    </div>

    <div id="messageBox" class="hidden mt-4 p-4 rounded-md border border-red-400 bg-red-50 text-red-800">
        <p class="text-sm" id="messageText"></p>
    </div>
</form>

<!-- DETECTION SECTION -->
<div id="playerBox" class="hidden mt-4 mb-4 p-4 rounded-lg border border-gray-300 bg-white text-gray-800">

    <div id="divPlayer" style="margin: 20px;">
        <audio id="audioPlayer" controls class="w-full"></audio>
    </div>

    <div id="loadingIndicator" class="hidden flex justify-center items-center text-gray-500">
        <span>Analyzing audio...</span>
        <img src="{{ url_for('static', filename='images/loading_icon.gif') }}" class="w-16 h-12" /> 
    </div>

    <!-- Show scale for detected tonality -->
    <div id="resultBox" class="hidden mt-4 p-4 rounded-lg border border-green-400 bg-green-50 text-green-800 result-box">
        <p class="font-medium text-center">Detected Key: <span id="detectedPitch" class="font-bold"></span></p>
    </div>

    <div class="t-6 flex justify-center mt-4">
        <a id="scaleLink" href="#" class="hidden submit-button">
            <b>Show Scale</b>
        </a>
        <button id="resetButton" class="reset-button"><b>Reset</b></button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/upload.js') }}"></script>
{% endblock %}